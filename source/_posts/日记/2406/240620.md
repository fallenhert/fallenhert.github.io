## 2024/06/20 星期四

### 工作内容

对之前 0613 写的页面进行优化，包括级联选择框、树型展示、可编辑表格三个部分。让这块能够支持更多形式的需求和展示。

第一个需求是需要在级联选择框上面进行扩展，能够为用户直接选中前四个。因为每命中一个选项需要发请求到后端请求当前层级的信息，使用`Promise.all`做了多次请求发送。遇到的问题是，使用 useState 维护了一个变量 optionObj，而发送请求的方法通过 useEffect()挂在了这个 optionObj 上。当 useState 初始化这个变量时，useEffect()会拉起一次发送请求。这一行为不符合预期并且这次请求的结果会覆盖正确行为结果。使用了 anthooks 提供的 useUpdateEffect 解决。

> useUpdateEffect 内部使用 useEffect 或 useLayoutEffect 来注册副作用函数。这两个 Hook 函数都接受一个回调函数和依赖项数组作为参数。当依赖项数组发生变化或组件更新时，副作用函数会被触发.
> 初始化阶段：在组件的初始化阶段（即首次渲染）时，useUpdateEffect 会记录一个标记（flag），表示当前组件是首次渲染。
> 更新阶段：在组件的更新阶段，useUpdateEffect 会判断当前是否是首次渲染。如果是首次渲染，则不执行副作用函数；如果不是首次渲染，则执行副作用函数。

通过 JSON.stringfy()处理了 JSON 展示问题。

遇到了神奇工具 `monaco-editor`
